<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Aurora Odyssey • Synesthetic Lab</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&family=IBM+Plex+Mono:wght@400;600&display=swap" rel="stylesheet" />
    <style>
        :root {
            --bg: radial-gradient(circle at 20% 20%, rgba(110, 245, 255, 0.4), transparent 55%),
                   radial-gradient(circle at 80% 15%, rgba(255, 111, 181, 0.35), transparent 60%),
                   linear-gradient(180deg, #020111 0%, #12072a 50%, #020111 100%);
            --panel: rgba(10, 8, 30, 0.8);
            --border: rgba(255, 255, 255, 0.12);
            --text: rgba(255, 255, 255, 0.92);
            --muted: rgba(255, 255, 255, 0.68);
            --accent: #6ef5ff;
            --accent-strong: #ffe483;
            --shadow: 0 25px 60px rgba(6, 12, 34, 0.4);
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            min-height: 100vh;
            font-family: "Space Grotesk", system-ui, sans-serif;
            color: var(--text);
            background: var(--bg);
            display: grid;
            grid-template-rows: auto 1fr auto;
        }

        header,
        footer {
            padding: 2rem clamp(1.5rem, 4vw, 3.5rem);
        }

        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1.5rem;
        }

        header a {
            text-decoration: none;
            text-transform: uppercase;
            letter-spacing: 0.22em;
            font-size: 0.75rem;
            color: var(--text);
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
        }

        header svg { width: 1.1rem; height: 1.1rem; }

        main {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: clamp(2rem, 5vw, 3.5rem);
            padding: 0 clamp(1.5rem, 4vw, 3.5rem) clamp(2.5rem, 6vw, 4rem);
        }

        .visualizer {
            position: relative;
            border-radius: 32px;
            overflow: hidden;
            border: 1px solid var(--border);
            background: rgba(4, 6, 18, 0.8);
            box-shadow: var(--shadow);
            min-height: min(70vh, 600px);
        }

        canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .panel {
            border-radius: 28px;
            padding: clamp(1.5rem, 4vw, 2.5rem);
            background: var(--panel);
            border: 1px solid var(--border);
            backdrop-filter: blur(18px);
            box-shadow: var(--shadow);
            display: grid;
            gap: 1.6rem;
            align-content: start;
        }

        h1 {
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 0.18em;
            font-size: clamp(1.8rem, 3.2vw, 2.6rem);
        }

        p { margin: 0; color: var(--muted); line-height: 1.8; }

        .pads {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 1rem;
        }

        .pad {
            border: 1px solid var(--border);
            border-radius: 18px;
            padding: 1.5rem 1.25rem;
            background: rgba(255, 255, 255, 0.05);
            text-align: left;
            cursor: pointer;
            transition: transform 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
            display: grid;
            gap: 0.35rem;
        }

        .pad span {
            font-size: 0.75rem;
            letter-spacing: 0.16em;
            text-transform: uppercase;
            color: var(--muted);
        }

        .pad strong {
            font-size: 1.1rem;
            letter-spacing: 0.08em;
        }

        .pad:hover,
        .pad:focus-visible {
            transform: translateY(-6px);
            border-color: var(--accent-strong);
            box-shadow: 0 18px 45px rgba(110, 245, 255, 0.3);
        }

        .palette {
            display: grid;
            gap: 0.85rem;
        }

        .swatch-row {
            display: flex;
            gap: 0.5rem;
        }

        .swatch {
            flex: 1;
            height: 40px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        button {
            border: 1px solid var(--border);
            border-radius: 999px;
            padding: 0.65rem 1.4rem;
            background: rgba(255, 255, 255, 0.08);
            color: var(--text);
            letter-spacing: 0.18em;
            text-transform: uppercase;
            font-size: 0.75rem;
            cursor: pointer;
            transition: transform 0.3s ease, border-color 0.3s ease;
        }

        button:hover,
        button:focus-visible {
            border-color: var(--accent-strong);
            transform: translateY(-2px);
        }

        footer {
            color: var(--muted);
            text-align: center;
            font-size: 0.8rem;
            letter-spacing: 0.16em;
            text-transform: uppercase;
        }

        .status {
            font-family: "IBM Plex Mono", monospace;
            font-size: 0.8rem;
            letter-spacing: 0.14em;
            color: var(--accent-strong);
        }

        kbd {
            display: inline-block;
            padding: 0.2rem 0.4rem;
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            font-size: 0.75rem;
            letter-spacing: 0.1em;
        }

        @media (max-width: 820px) {
            header { flex-direction: column; align-items: flex-start; }
        }
    </style>
</head>
<body>
    <header>
        <a href="index.html">
            <svg aria-hidden="true" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
                <path d="M19 12H5m6 6l-6-6 6-6" />
            </svg>
            Mission Control
        </a>
        <div class="status" id="status">Audio engine idle</div>
    </header>

    <main>
        <div class="visualizer">
            <canvas id="visualizer" role="img" aria-label="Audio reactive spectrum"></canvas>
        </div>
        <aside class="panel">
            <div>
                <h1>Synesthetic lab</h1>
                <p>
                    Trigger chromatic pads to launch chords. The Web Audio engine weaves oscillators and noise into lush beds,
                    while the canvas spectrum paints every frequency. Save palettes generated by your performance.
                </p>
            </div>
            <div class="pads" role="list">
                <button class="pad" data-chord="A3,C#4,E4" style="--pad-color:#6ef5ff" type="button">
                    <strong>Glacier Pad</strong>
                    <span>A · C♯ · E</span>
                </button>
                <button class="pad" data-chord="F3,A3,C4" style="--pad-color:#ff9be7" type="button">
                    <strong>Magenta Bloom</strong>
                    <span>F · A · C</span>
                </button>
                <button class="pad" data-chord="G3,B3,D4" style="--pad-color:#ffe483" type="button">
                    <strong>Solar Flare</strong>
                    <span>G · B · D</span>
                </button>
                <button class="pad" data-chord="E3,G#3,B3" style="--pad-color:#9cffae" type="button">
                    <strong>Verdant Echo</strong>
                    <span>E · G♯ · B</span>
                </button>
            </div>
            <div class="palette">
                <div class="swatch-row" id="swatches">
                    <div class="swatch" style="background: linear-gradient(135deg, #6ef5ff, #ffe483);"></div>
                    <div class="swatch" style="background: linear-gradient(135deg, #ff9be7, #6ef5ff);"></div>
                    <div class="swatch" style="background: linear-gradient(135deg, #ffe483, #9cffae);"></div>
                </div>
                <button type="button" id="savePalette">Save Palette</button>
                <p id="paletteStatus">Tap pads to update the palette blend. Press <kbd>S</kbd> to save without clicking.</p>
            </div>
        </aside>
    </main>

    <footer>Web Audio + generative spectra • Aurora Odyssey Portals</footer>

    <script>
        const canvas = document.getElementById("visualizer");
        const ctx = canvas.getContext("2d");
        const status = document.getElementById("status");
        const padButtons = Array.from(document.querySelectorAll(".pad"));
        const saveButton = document.getElementById("savePalette");
        const swatches = document.getElementById("swatches");
        const paletteStatus = document.getElementById("paletteStatus");
        const prefersReducedMotion = window.matchMedia("(prefers-reduced-motion: reduce)").matches;

        let width, height;
        let analyser;
        let dataArray;
        let audioContext;
        let masterGain;
        let visualFrame;
        const palettes = [];
        let currentPalette = ["#6ef5ff", "#ff9be7", "#ffe483", "#9cffae"];

        function resize() {
            width = canvas.clientWidth;
            height = canvas.clientHeight;
            const dpr = window.devicePixelRatio || 1;
            canvas.width = width * dpr;
            canvas.height = height * dpr;
            ctx.setTransform(1, 0, 0, 1, 0, 0);
            ctx.scale(dpr, dpr);
        }

        async function prepareAudio() {
            if (audioContext) return;
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            masterGain = audioContext.createGain();
            masterGain.gain.value = 0.6;
            analyser = audioContext.createAnalyser();
            analyser.fftSize = 1024;
            dataArray = new Uint8Array(analyser.frequencyBinCount);
            masterGain.connect(analyser);
            analyser.connect(audioContext.destination);
            status.textContent = "Audio engine armed";
        }

        function noteToFrequency(note) {
            const [pitch, octave] = note.split(/(?=\d)/);
            const reference = { C: 0, "C#": 1, Db: 1, D: 2, "D#": 3, Eb: 3, E: 4, F: 5, "F#": 6, Gb: 6, G: 7, "G#": 8, Ab: 8, A: 9, "A#": 10, Bb: 10, B: 11 };
            const semitone = reference[pitch];
            const oct = parseInt(octave, 10);
            const midi = (oct + 1) * 12 + semitone;
            return 440 * Math.pow(2, (midi - 69) / 12);
        }

        function triggerPad(pad) {
            prepareAudio();
            if (audioContext.state === "suspended") {
                audioContext.resume();
            }

            const chord = pad.dataset.chord.split(",").map((note) => noteToFrequency(note.trim()));
            const color = pad.style.getPropertyValue("--pad-color") || "#6ef5ff";
            currentPalette.unshift(color);
            currentPalette = currentPalette.slice(0, 4);
            updateSwatches();

            const now = audioContext.currentTime;
            const chordGain = audioContext.createGain();
            chordGain.gain.setValueAtTime(0, now);
            chordGain.gain.linearRampToValueAtTime(0.8, now + 0.02);
            chordGain.gain.exponentialRampToValueAtTime(0.0001, now + 2.8);
            chordGain.connect(masterGain);

            chord.forEach((frequency, index) => {
                const osc = audioContext.createOscillator();
                const lfo = audioContext.createOscillator();
                const lfoGain = audioContext.createGain();
                lfo.frequency.value = 0.35 + index * 0.12;
                lfoGain.gain.value = 5 + index * 2;
                lfo.connect(lfoGain);
                lfoGain.connect(osc.frequency);
                osc.type = index % 2 === 0 ? "sine" : "triangle";
                osc.frequency.setValueAtTime(frequency, now);
                osc.connect(chordGain);
                osc.start(now);
                osc.stop(now + 3);
                lfo.start(now);
                lfo.stop(now + 3);
            });

            const noiseBuffer = audioContext.createBuffer(1, audioContext.sampleRate * 2, audioContext.sampleRate);
            const output = noiseBuffer.getChannelData(0);
            for (let i = 0; i < output.length; i++) {
                output[i] = (Math.random() * 2 - 1) * (1 - i / output.length);
            }
            const noiseSource = audioContext.createBufferSource();
            noiseSource.buffer = noiseBuffer;
            const noiseGain = audioContext.createGain();
            noiseGain.gain.setValueAtTime(0, now);
            noiseGain.gain.linearRampToValueAtTime(0.3, now + 0.05);
            noiseGain.gain.exponentialRampToValueAtTime(0.0001, now + 1.6);
            noiseSource.connect(noiseGain);
            noiseGain.connect(masterGain);
            noiseSource.start(now);
            noiseSource.stop(now + 1.6);

            status.textContent = `Playing ${pad.textContent.trim()}`;
        }

        function updateSwatches() {
            const gradients = [
                `linear-gradient(135deg, ${currentPalette[0]}, ${currentPalette[1]})`,
                `linear-gradient(135deg, ${currentPalette[1]}, ${currentPalette[2]})`,
                `linear-gradient(135deg, ${currentPalette[2]}, ${currentPalette[3]})`,
            ];
            Array.from(swatches.children).forEach((swatch, index) => {
                swatch.style.background = gradients[index % gradients.length];
            });
        }

        function savePalette() {
            palettes.push([...currentPalette]);
            paletteStatus.textContent = `Saved palette ${palettes.length}: ${currentPalette.join(" · ")}`;
        }

        function animate() {
            if (!analyser) {
                ctx.fillStyle = "rgba(10, 12, 26, 1)";
                ctx.fillRect(0, 0, width, height);
                return;
            }

            analyser.getByteFrequencyData(dataArray);
            ctx.fillStyle = prefersReducedMotion ? "rgba(10, 12, 26, 1)" : "rgba(10, 12, 26, 0.2)";
            ctx.fillRect(0, 0, width, height);

            const barWidth = width / dataArray.length * 2.5;
            let x = 0;
            for (let i = 0; i < dataArray.length; i++) {
                const value = dataArray[i];
                const percent = value / 255;
                const barHeight = percent * height * 0.9;
                const hue = (i / dataArray.length) * 360;
                ctx.fillStyle = `hsla(${hue}, 90%, ${50 + percent * 35}%, ${prefersReducedMotion ? 0.9 : 0.6})`;
                ctx.fillRect(x, height - barHeight, barWidth, barHeight);
                x += barWidth + 1;
            }

            if (!prefersReducedMotion) {
                const gradient = ctx.createRadialGradient(width / 2, height / 2, 0, width / 2, height / 2, Math.min(width, height));
                gradient.addColorStop(0, `${currentPalette[0]}22`);
                gradient.addColorStop(0.5, `${currentPalette[1]}11`);
                gradient.addColorStop(1, "rgba(0, 0, 0, 0)");
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, width, height);
            }

            visualFrame = requestAnimationFrame(animate);
        }

        padButtons.forEach((pad) => {
            pad.addEventListener("click", () => triggerPad(pad));
            pad.addEventListener("keydown", (event) => {
                if (event.key === "Enter" || event.key === " ") {
                    event.preventDefault();
                    triggerPad(pad);
                }
            });
        });

        saveButton.addEventListener("click", savePalette);

        window.addEventListener("keydown", (event) => {
            if (event.key === "s" || event.key === "S") {
                savePalette();
            }
        });

        window.addEventListener("resize", resize);

        resize();
        updateSwatches();
        animate();
    </script>
</body>
</html>
